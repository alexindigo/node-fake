var vm = require('vm');
var fs = require('fs');

function Sandbox(properties) {
  this.context = null;

  this._path = null;
  this._source = null;

  for (var property in properties) {
    this[property] = properties[property];
  }
}
module.exports = Sandbox;

Sandbox.create = function(context) {
  return new Sandbox({
    context: context || {},
  });
};

Sandbox.createFromFile = function(path, context) {
  var sandbox = Sandbox.create(context);
  sandbox.loadSource(path);
  sandbox.compile();
  return sandbox;
};

Sandbox.createFromSource = function(source, context) {
  var sandbox = Sandbox.create(context);
  sandbox.setSource(source);
  sandbox.compile();
  return sandbox;
};

Sandbox.prototype.loadSource = function(path) {
  this._path = path;
  this.setSource(fs.readFileSync(path, 'utf8'));
};

Sandbox.prototype.setSource = function(source, path) {
  this._source = source;
  this._path = path;
};

Sandbox.prototype.compile = function() {
  return vm.runInNewContext(this._source, this.context, this._path);
};
